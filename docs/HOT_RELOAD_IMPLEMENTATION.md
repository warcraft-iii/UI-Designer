# ğŸ”¥ çƒ­é‡è½½ç³»ç»Ÿå®ç°æ–¹æ¡ˆï¼ˆåŸºäº DzAPIï¼‰

## ğŸ“‹ æ–¹æ¡ˆæ¦‚è¿°

åŸºäº War3 1.27 çš„ DzAPIï¼Œå®ç°ç¼–è¾‘å™¨å®æ—¶å¯¼å‡º FDF â†’ æ¸¸æˆå†…è‡ªåŠ¨/æ‰‹åŠ¨é‡è½½çš„å®Œæ•´çƒ­é‡è½½ç³»ç»Ÿã€‚

> **æ³¨æ„**: ä¸å†æ”¯æŒ 1.27 Native æ¨¡å¼ï¼Œå› ä¸ºå®ƒä¸æ”¯æŒè‡ªå®šä¹‰UIã€‚ä»…æ”¯æŒ:
> - âœ… War3 1.27 + DzAPI (11å¹³å°)
> - âœ… War3 Reforged 1.31+

---

## ğŸ¯ æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   UI Designer ç¼–è¾‘å™¨                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  é¡¹ç›®ç›‘å¬å™¨   â”‚â†’ â”‚  FDFå¯¼å‡ºå™¨   â”‚â†’ â”‚  æ–‡ä»¶å†™å…¥å™¨   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ å®æ—¶å¯¼å‡º
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           War3å®‰è£…ç›®å½•/UI-Designer/                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ current.fdf â”‚  â”‚ current.toc â”‚  â”‚ textures/   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ æ¸¸æˆå†…åŠ è½½
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              UI-Designer.w3x æ¡†æ¶åœ°å›¾                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  InitTrig_UIDesigner (Luaè§¦å‘å™¨)              â”‚       â”‚
â”‚  â”‚  - DzLoadToc("UI-Designer\\current.toc")     â”‚       â”‚
â”‚  â”‚  - ç›‘å¬ -reload å‘½ä»¤                           â”‚       â”‚
â”‚  â”‚  - (å¯é€‰) æ–‡ä»¶å˜åŒ–è‡ªåŠ¨æ£€æµ‹                       â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ç›®å½•ç»“æ„

```
War3å®‰è£…ç›®å½•/
â”œâ”€â”€ war3.exe / Warcraft III.exe
â”œâ”€â”€ UI-Designer/                    # è‡ªåŠ¨åˆ›å»º
â”‚   â”œâ”€â”€ UI-Designer.w3x            # æ¡†æ¶åœ°å›¾ (è‡ªåŠ¨ç”Ÿæˆ)
â”‚   â”œâ”€â”€ current.fdf                # å½“å‰UIå®šä¹‰ (å®æ—¶æ›´æ–°)
â”‚   â”œâ”€â”€ current.toc                # TOCç´¢å¼•æ–‡ä»¶
â”‚   â””â”€â”€ textures/                  # çº¹ç†èµ„æº (å¯é€‰)
â””â”€â”€ Maps/
```

---

## ğŸ”§ æ ¸å¿ƒä»£ç å®ç°

### 1. ç‰ˆæœ¬æ£€æµ‹ (TypeScript)

```typescript
// src/utils/war3VersionDetector.ts

export enum War3Version {
  CLASSIC_DZAPI = '1.27_DzAPI',  // 1.27 + 11å¹³å° (DzAPI)
  REFORGED = '1.31+'              // é‡åˆ¶ç‰ˆ (BlzAPI)
}

export interface War3Info {
  version: War3Version;
  installPath: string;
  executable: string;
  supportedAPIs: {
    dzLoadToc: boolean;           // DzLoadToc
    dzCreateFrame: boolean;       // DzCreateFrame
    blzLoadTOCFile: boolean;      // BlzLoadTOCFile
    blzCreateFrame: boolean;      // BlzCreateFrame
  };
  autoReloadSupport: boolean;     // æ˜¯å¦æ”¯æŒæ–‡ä»¶å˜åŒ–æ£€æµ‹
}

/**
 * æ£€æµ‹ War3 ç‰ˆæœ¬å’Œ API æ”¯æŒ
 */
export async function detectWar3Version(war3Path: string): Promise<War3Info> {
  const { exists } = await import('@tauri-apps/plugin-fs');
  const { join } = await import('@tauri-apps/api/path');
  
  // æ£€æŸ¥å¯æ‰§è¡Œæ–‡ä»¶
  const classicExe = await join(war3Path, 'war3.exe');
  const reforgedExe = await join(war3Path, 'Warcraft III.exe');
  
  const hasClassic = await exists(classicExe);
  const hasReforged = await exists(reforgedExe);
  
  if (hasReforged) {
    return {
      version: War3Version.REFORGED,
      installPath: war3Path,
      executable: 'Warcraft III.exe',
      supportedAPIs: {
        dzLoadToc: false,
        dzCreateFrame: false,
        blzLoadTOCFile: true,
        blzCreateFrame: true,
      },
      autoReloadSupport: false // Reforged æš‚ä¸æ”¯æŒæ–‡ä»¶ç›‘æ§
    };
  }
  
  if (hasClassic) {
    // æ£€æŸ¥ DzAPI æ”¯æŒ (æ£€æŸ¥ç‰¹å¾æ–‡ä»¶)
    const dzApiMarker = await join(war3Path, 'Game.dll'); 
    const hasDzAPI = await exists(dzApiMarker);
    
    if (!hasDzAPI) {
      throw new Error(
        'War3 1.27 éœ€è¦å®‰è£… 11å¹³å°æ‰èƒ½ä½¿ç”¨è‡ªå®šä¹‰UIåŠŸèƒ½\n' +
        'è¯·è®¿é—®: https://www.11game.com/ ä¸‹è½½å®‰è£…'
      );
    }
    
    return {
      version: War3Version.CLASSIC_DZAPI,
      installPath: war3Path,
      executable: 'war3.exe',
      supportedAPIs: {
        dzLoadToc: true,
        dzCreateFrame: true,
        blzLoadTOCFile: false,
        blzCreateFrame: false,
      },
      autoReloadSupport: true // DzAPI æ”¯æŒæ–‡ä»¶æ—¶é—´æˆ³æ£€æµ‹
    };
  }
  
  throw new Error('æ— æ³•æ£€æµ‹åˆ°æœ‰æ•ˆçš„ War3 å®‰è£…');
}
```

### 2. çƒ­é‡è½½è§¦å‘å™¨ (Lua - ç»Ÿä¸€ç‰ˆæœ¬)

```lua
-- æ¡†æ¶åœ°å›¾ä¸­çš„è§¦å‘å™¨ä»£ç 
-- æ–‡ä»¶: war3map.lua æˆ– custom_script.txt

--===========================================================================
-- UI Designer - çƒ­é‡è½½ç³»ç»Ÿ
-- æ”¯æŒ: War3 1.27 (DzAPI) / Reforged (BlzAPI)
--===========================================================================

local UI_Frames = {}
local UI_LastModTime = 0
local UI_DesignerPath = "UI-Designer\\\\current"

--===========================================================================
-- API å…¼å®¹å±‚
--===========================================================================
local LoadTOC, CreateFrame, DestroyFrame, GetGameUI, ShowFrame

if DzLoadToc then
    -- War3 1.27 + DzAPI ç¯å¢ƒ
    print("|cff00ff00[UI Designer] æ£€æµ‹åˆ° DzAPI (War3 1.27)|r")
    
    LoadTOC = function(path)
        return DzLoadToc(path)
    end
    
    CreateFrame = function(frameType, name, parent, template, id)
        return DzCreateFrame(frameType, parent, id)
    end
    
    DestroyFrame = function(frame)
        return DzDestroyFrame(frame)
    end
    
    GetGameUI = function()
        return DzGetGameUI()
    end
    
    ShowFrame = function(frame, show)
        return DzFrameShow(frame, show)
    end
    
elseif BlzLoadTOCFile then
    -- Reforged ç¯å¢ƒ
    print("|cff00ff00[UI Designer] æ£€æµ‹åˆ° Reforged API (War3 1.31+)|r")
    
    LoadTOC = function(path)
        return BlzLoadTOCFile(path)
    end
    
    CreateFrame = function(frameType, name, parent, template, id)
        return BlzCreateFrameByType(frameType, name, parent, template, id)
    end
    
    DestroyFrame = function(frame)
        return BlzDestroyFrame(frame)
    end
    
    GetGameUI = function()
        return BlzGetOriginFrame(ORIGIN_FRAME_GAME_UI, 0)
    end
    
    ShowFrame = function(frame, show)
        return BlzFrameSetVisible(frame, show)
    end
    
else
    -- æ— UI APIæ”¯æŒ
    print("|cffff0000========================================|r")
    print("|cffff0000  é”™è¯¯: æœªæ£€æµ‹åˆ° UI API æ”¯æŒ           |r")
    print("|cffffcc00  War3 1.27 ç”¨æˆ·: è¯·å®‰è£… 11å¹³å°       |r")
    print("|cffffcc00  ä¸‹è½½: https://www.11game.com/       |r")
    print("|cffffcc00  Reforged ç”¨æˆ·: è¯·æ›´æ–°åˆ° 1.31+      |r")
    print("|cffff0000========================================|r")
    return
end

--===========================================================================
-- æ¸…ç†æ‰€æœ‰UI
--===========================================================================
local function UI_CleanupAll()
    for i, frame in ipairs(UI_Frames) do
        if frame then
            DestroyFrame(frame)
        end
    end
    UI_Frames = {}
    collectgarbage()
end

--===========================================================================
-- åŠ è½½UI (ä»å¤–éƒ¨FDFæ–‡ä»¶)
--===========================================================================
local function UI_LoadFromFile()
    local startTime = os.clock()
    
    UI_CleanupAll()
    
    -- åŠ è½½TOCæ–‡ä»¶
    local tocPath = UI_DesignerPath .. ".toc"
    local success = LoadTOC(tocPath)
    
    if success then
        UI_LastModTime = os.clock()
        local loadTime = (os.clock() - startTime) * 1000
        print(string.format(
            "|cff00ff00[UI Designer]|r UIå·²é‡æ–°åŠ è½½ (%.1fms)", 
            loadTime
        ))
    else
        print("|cffff0000[UI Designer]|r åŠ è½½å¤±è´¥!")
        print("|cffffcc00è¯·æ£€æŸ¥æ–‡ä»¶: " .. tocPath .. "|r")
    end
end

--===========================================================================
-- æ–‡ä»¶å˜åŒ–æ£€æµ‹ (ä»… DzAPI æ”¯æŒ)
--===========================================================================
local function UI_CheckFileModified()
    if not DzAPI_Map then
        return false
    end
    
    -- DzAPI å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼æ£€æµ‹æ–‡ä»¶å˜åŒ–
    -- ä¾‹å¦‚: è¯»å–æ–‡ä»¶å†…å®¹çš„å“ˆå¸Œå€¼æ¯”è¾ƒ
    -- è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…å¯ä»¥æ›´ç²¾ç¡®
    
    return false -- æš‚æ—¶ç¦ç”¨è‡ªåŠ¨æ£€æµ‹ï¼Œä½¿ç”¨æ‰‹åŠ¨å‘½ä»¤
end

--===========================================================================
-- è‡ªåŠ¨é‡è½½å®šæ—¶å™¨ (å¯é€‰åŠŸèƒ½)
--===========================================================================
local function UI_AutoReloadTimer()
    if UI_CheckFileModified() then
        print("|cffffcc00[UI Designer]|r æ£€æµ‹åˆ°æ–‡ä»¶å˜åŒ–ï¼Œè‡ªåŠ¨é‡è½½...")
        UI_LoadFromFile()
    end
end

--===========================================================================
-- æ‰‹åŠ¨é‡è½½å‘½ä»¤
--===========================================================================
local function UI_ReloadCommand()
    UI_LoadFromFile()
end

--===========================================================================
-- åˆå§‹åŒ–
--===========================================================================
function InitTrig_UIDesigner()
    local t = CreateTrigger()
    
    -- æ³¨å†Œé‡è½½å‘½ä»¤
    TriggerRegisterPlayerChatEvent(t, Player(0), "-reload", true)
    TriggerRegisterPlayerChatEvent(t, Player(0), "-rl", true)
    TriggerAddAction(t, UI_ReloadCommand)
    
    -- å¯é€‰: å¯ç”¨è‡ªåŠ¨æ£€æµ‹å®šæ—¶å™¨ (DzAPI)
    if DzLoadToc then
        -- æš‚æ—¶ç¦ç”¨è‡ªåŠ¨æ£€æµ‹ï¼Œæ€§èƒ½è€ƒè™‘
        -- local timer = CreateTimer()
        -- TimerStart(timer, 1.0, true, UI_AutoReloadTimer)
        -- print("|cff00ff00[UI Designer]|r æ–‡ä»¶è‡ªåŠ¨ç›‘æ§å·²å¯ç”¨ (æ¯ç§’æ£€æŸ¥)")
    end
    
    -- é¦–æ¬¡åŠ è½½
    UI_LoadFromFile()
    
    -- æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
    print("|cff00ffff" .. string.rep("=", 50) .. "|r")
    print("|cffffcc00          UI Designer çƒ­é‡è½½ç³»ç»Ÿ v1.0           |r")
    print("|cff00ff00  å‘½ä»¤: -reload æˆ– -rl  åˆ·æ–°UI                  |r")
    print("|cffaaaaaa  æç¤º: åœ¨ç¼–è¾‘å™¨ä¸­ä¿®æ”¹åï¼Œåœ¨æ¸¸æˆä¸­è¾“å…¥å‘½ä»¤æŸ¥çœ‹æ•ˆæœ  |r")
    print("|cff00ffff" .. string.rep("=", 50) .. "|r")
end
```

### 3. FDF å®æ—¶å¯¼å‡ºå™¨ (TypeScript)

```typescript
// src/utils/hotReloadExporter.ts

import { useProjectStore } from '../store/projectStore';
import { War3Info } from './war3VersionDetector';
import { exportProjectToFDF } from './fdfExporter';

export class HotReloadExporter {
  private war3Info: War3Info | null = null;
  private isEnabled: boolean = false;
  private unsubscribe: (() => void) | null = null;
  private exportTimer: NodeJS.Timeout | null = null;
  
  /**
   * å¯ç”¨çƒ­é‡è½½
   */
  async enable(war3Info: War3Info) {
    this.war3Info = war3Info;
    this.isEnabled = true;
    
    // é˜²æŠ–å¤„ç†ï¼šé¿å…è¿‡äºé¢‘ç¹çš„å¯¼å‡º
    const debouncedExport = this.debounce(
      async (project: any) => {
        if (!this.isEnabled) return;
        await this.exportFDF(project);
      },
      500 // 500ms é˜²æŠ–
    );
    
    // ç›‘å¬é¡¹ç›®å˜åŒ–
    this.unsubscribe = useProjectStore.subscribe(
      async (state) => {
        debouncedExport(state.project);
      }
    );
    
    // ç«‹å³å¯¼å‡ºä¸€æ¬¡
    const state = useProjectStore.getState();
    await this.exportFDF(state.project);
    
    console.log('[HotReload] å·²å¯ç”¨ï¼Œç›®æ ‡:', war3Info.installPath);
  }
  
  /**
   * ç¦ç”¨çƒ­é‡è½½
   */
  disable() {
    this.isEnabled = false;
    if (this.unsubscribe) {
      this.unsubscribe();
      this.unsubscribe = null;
    }
    if (this.exportTimer) {
      clearTimeout(this.exportTimer);
      this.exportTimer = null;
    }
  }
  
  /**
   * å¯¼å‡º FDF æ–‡ä»¶
   */
  private async exportFDF(project: any) {
    if (!this.war3Info) return;
    
    try {
      const { writeTextFile, createDir } = await import('@tauri-apps/plugin-fs');
      const { join } = await import('@tauri-apps/api/path');
      
      // åˆ›å»ºè¾“å‡ºç›®å½•
      const outputDir = await join(this.war3Info.installPath, 'UI-Designer');
      await createDir(outputDir, { recursive: true });
      
      // ç”Ÿæˆ FDF å†…å®¹
      const fdfContent = exportProjectToFDF(project);
      const tocContent = this.generateTOC();
      
      // å†™å…¥æ–‡ä»¶
      const fdfPath = await join(outputDir, 'current.fdf');
      const tocPath = await join(outputDir, 'current.toc');
      
      await writeTextFile(fdfPath, fdfContent);
      await writeTextFile(tocPath, tocContent);
      
      console.log('[HotReload] FDFå·²å¯¼å‡º:', fdfPath);
      
      // è§¦å‘é€šçŸ¥ (å¯é€‰)
      this.notifyExported(fdfPath);
    } catch (error) {
      console.error('[HotReload] å¯¼å‡ºå¤±è´¥:', error);
      throw error;
    }
  }
  
  /**
   * ç”Ÿæˆ TOC å†…å®¹
   */
  private generateTOC(): string {
    return 'UI-Designer\\current.fdf\n';
  }
  
  /**
   * é˜²æŠ–å‡½æ•°
   */
  private debounce<T extends (...args: any[]) => any>(
    func: T,
    wait: number
  ): (...args: Parameters<T>) => void {
    return (...args: Parameters<T>) => {
      if (this.exportTimer) {
        clearTimeout(this.exportTimer);
      }
      this.exportTimer = setTimeout(() => func(...args), wait);
    };
  }
  
  /**
   * é€šçŸ¥å¯¼å‡ºå®Œæˆ
   */
  private notifyExported(path: string) {
    // å¯ä»¥è§¦å‘ toast é€šçŸ¥
    console.log('âœ… å·²å¯¼å‡ºåˆ°:', path);
  }
}

// å…¨å±€å®ä¾‹
export const hotReloadExporter = new HotReloadExporter();
```

### 4. UI é›†æˆé¢æ¿ (React)

```typescript
// src/components/HotReloadPanel.tsx

import React, { useState, useEffect } from 'react';
import { detectWar3Version, War3Info } from '../utils/war3VersionDetector';
import { hotReloadExporter } from '../utils/hotReloadExporter';
import './HotReloadPanel.css';

export const HotReloadPanel: React.FC = () => {
  const [war3Info, setWar3Info] = useState<War3Info | null>(null);
  const [isEnabled, setIsEnabled] = useState(false);
  const [status, setStatus] = useState<string>('æœªå¯ç”¨');
  const [error, setError] = useState<string>('');
  
  // åˆå§‹åŒ–ï¼šè‡ªåŠ¨æ£€æµ‹
  useEffect(() => {
    handleDetect();
  }, []);
  
  // æ£€æµ‹ War3 ç‰ˆæœ¬
  const handleDetect = async () => {
    try {
      setError('');
      const war3Path = localStorage.getItem('war3_install_path');
      if (!war3Path) {
        setError('è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½® War3 å®‰è£…è·¯å¾„');
        return;
      }
      
      const info = await detectWar3Version(war3Path);
      setWar3Info(info);
      setStatus(`âœ… ${info.version}`);
    } catch (error: any) {
      setError(error.message);
      setStatus('âŒ æ£€æµ‹å¤±è´¥');
    }
  };
  
  // åˆ‡æ¢çƒ­é‡è½½
  const handleToggleHotReload = async () => {
    if (!war3Info) return;
    
    try {
      if (isEnabled) {
        hotReloadExporter.disable();
        setIsEnabled(false);
        setStatus(`${war3Info.version} (å·²åœæ­¢)`);
      } else {
        await hotReloadExporter.enable(war3Info);
        setIsEnabled(true);
        setStatus(`${war3Info.version} (è¿è¡Œä¸­)`);
      }
    } catch (error: any) {
      setError('å¯ç”¨å¤±è´¥: ' + error.message);
    }
  };
  
  return (
    <div className="hot-reload-panel">
      <div className="panel-header">
        <h3>ğŸ”¥ çƒ­é‡è½½ç³»ç»Ÿ</h3>
        <div className={`status-badge ${isEnabled ? 'active' : ''}`}>
          {isEnabled ? 'è¿è¡Œä¸­' : 'æœªå¯ç”¨'}
        </div>
      </div>
      
      {error && (
        <div className="error-message">
          âš ï¸ {error}
        </div>
      )}
      
      {war3Info && (
        <div className="info-section">
          <div className="info-row">
            <span className="label">ç‰ˆæœ¬:</span>
            <span className="value">{war3Info.version}</span>
          </div>
          <div className="info-row">
            <span className="label">è·¯å¾„:</span>
            <span className="value" title={war3Info.installPath}>
              {war3Info.installPath}
            </span>
          </div>
          <div className="info-row">
            <span className="label">APIæ”¯æŒ:</span>
            <span className="value">
              {war3Info.supportedAPIs.dzLoadToc && 'DzLoadToc '}
              {war3Info.supportedAPIs.blzLoadTOCFile && 'BlzLoadTOCFile'}
            </span>
          </div>
        </div>
      )}
      
      <div className="actions">
        <button 
          className="btn-primary"
          onClick={handleToggleHotReload}
          disabled={!war3Info}
        >
          {isEnabled ? 'â¸ï¸ åœæ­¢çƒ­é‡è½½' : 'â–¶ï¸ å¯ç”¨çƒ­é‡è½½'}
        </button>
        
        <button 
          className="btn-secondary"
          onClick={handleDetect}
        >
          ğŸ” é‡æ–°æ£€æµ‹
        </button>
      </div>
      
      <div className="instructions">
        <h4>ğŸ“– ä½¿ç”¨è¯´æ˜</h4>
        <ol>
          <li>ç¡®ä¿å·²å®‰è£… War3 (1.27éœ€è¦11å¹³å°)</li>
          <li>ç‚¹å‡»"å¯ç”¨çƒ­é‡è½½"å¼€å§‹ç›‘å¬</li>
          <li>åœ¨ç¼–è¾‘å™¨ä¸­ä¿®æ”¹ UI</li>
          <li>åœ¨æ¸¸æˆä¸­è¾“å…¥ <code>-reload</code> æŸ¥çœ‹æ•ˆæœ</li>
        </ol>
        
        <div className="tips">
          <strong>ğŸ’¡ æç¤º:</strong>
          <ul>
            <li>ä¿®æ”¹ä¼šè‡ªåŠ¨å¯¼å‡ºåˆ° <code>War3è·¯å¾„/UI-Designer/</code></li>
            <li>éœ€è¦åœ¨æ¸¸æˆä¸­æ‰‹åŠ¨è¾“å…¥å‘½ä»¤é‡è½½ (æ€§èƒ½è€ƒè™‘)</li>
            <li>æ¡†æ¶åœ°å›¾ä½ç½®: <code>War3è·¯å¾„/UI-Designer/UI-Designer.w3x</code></li>
          </ul>
        </div>
      </div>
    </div>
  );
};
```

---

## ğŸ“‹ å®æ–½æ­¥éª¤

### é˜¶æ®µ 1: åŸºç¡€è®¾æ–½ âœ…
1. âœ… War3 ç‰ˆæœ¬æ£€æµ‹ (DzAPI / Reforged)
2. âœ… ç›®å½•ç»“æ„åˆ›å»º
3. âœ… FDF å¯¼å‡ºå™¨

### é˜¶æ®µ 2: çƒ­é‡è½½æ ¸å¿ƒ ğŸ”„
1. âœ… ç»Ÿä¸€è§¦å‘å™¨ä»£ç  (Lua)
2. âœ… é¡¹ç›®ç›‘å¬ + å®æ—¶å¯¼å‡º
3. âœ… é˜²æŠ–ä¼˜åŒ–

### é˜¶æ®µ 3: æ¡†æ¶åœ°å›¾ç”Ÿæˆ â³
1. â³ Rust åç«¯åœ°å›¾æ‰“åŒ…
2. â³ é¢„åˆ¶åœ°å›¾æ¨¡æ¿
3. â³ è‡ªåŠ¨ç”ŸæˆåŠŸèƒ½

### é˜¶æ®µ 4: UI é›†æˆ â³
1. â³ çƒ­é‡è½½é¢æ¿ç»„ä»¶
2. â³ çŠ¶æ€ç®¡ç†
3. â³ é”™è¯¯å¤„ç†

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### DzAPI ç‰¹æ€§
- âœ… `DzLoadToc()` - åŠ è½½å¤–éƒ¨ FDF
- âœ… `DzCreateFrame()` - åŠ¨æ€åˆ›å»ºUI
- âœ… `DzFrameShow()` - æ˜¾ç¤º/éšè—
- âœ… `DzDestroyFrame()` - é”€æ¯UI

### æ€§èƒ½è€ƒè™‘
- ä½¿ç”¨é˜²æŠ– (500ms) é¿å…é¢‘ç¹å¯¼å‡º
- æ¸…ç†æ—§ Frame é‡Šæ”¾å†…å­˜
- å¤§å‹ UI å¯èƒ½éœ€è¦åˆ†æ‰¹åŠ è½½

### å…¼å®¹æ€§
- War3 1.27 å¿…é¡»å®‰è£… 11å¹³å°
- Reforged éœ€è¦ 1.31+ ç‰ˆæœ¬
- æ–‡ä»¶è·¯å¾„ç›¸å¯¹äº War3 æ ¹ç›®å½•

---

## ğŸ¯ ä¼˜åŠ¿

- âœ… **å³æ—¶åé¦ˆ**: ä¿®æ”¹åç§’çº§å¯¼å‡ºï¼Œæ¸¸æˆå†…ä¸€é”®åˆ·æ–°
- âœ… **ç‰ˆæœ¬å…¼å®¹**: è‡ªåŠ¨é€‚é… 1.27 (DzAPI) å’Œ Reforged
- âœ… **é›¶é…ç½®**: è‡ªåŠ¨ç”Ÿæˆæ‰€éœ€æ–‡ä»¶å’Œç›®å½•
- âœ… **å¼€å‘å‹å¥½**: æ ‡å‡† War3 èµ„æºæ ¼å¼

---

## ğŸ“š ç›¸å…³èµ„æº

- [11å¹³å°å®˜ç½‘](https://www.11game.com/)
- [DzAPI æ–‡æ¡£](vendor/1.27/Scripts/)
- [War3 FDF æ ¼å¼è§„èŒƒ](docs/FDF_PARSER_GUIDE.md)
