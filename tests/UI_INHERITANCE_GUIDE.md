# ç»§æ‰¿å­æ§ä»¶UIåŠŸèƒ½æµ‹è¯•æŒ‡å—

## åŠŸèƒ½æ¦‚è¿°

å®ç°äº†å®Œæ•´çš„FDFæ¨¡æ¿ç»§æ‰¿ç³»ç»Ÿï¼ŒåŒ…æ‹¬ç¼–è¾‘å™¨UIå±‚é¢çš„åªè¯»ä¿æŠ¤ã€‚

## æ ¸å¿ƒåŠŸèƒ½

### 1. FDFè§£æå’Œå¯¼å‡º
- âœ… IncludeFile æŒ‡ä»¤è§£æï¼ˆè‡ªåŠ¨åŠ è½½æ¨¡æ¿æ–‡ä»¶ï¼‰
- âœ… INHERITS å±æ€§ç»§æ‰¿ï¼ˆå¯è¦†ç›–ï¼‰
- âœ… WITHCHILDREN å­æ§ä»¶æ ‘æ·±æ‹·è´
- âœ… å¯¼å‡ºæ—¶è¿‡æ»¤ç»§æ‰¿çš„å­æ§ä»¶ï¼ˆä¿æŒFDFç®€æ´ï¼‰
- âœ… RoundtripéªŒè¯é€šè¿‡ç‡ï¼š91.7% (77/84)

### 2. ç¼–è¾‘å™¨UIä¿æŠ¤

#### ProjectTreeï¼ˆå±‚çº§æ ‘ï¼‰
- ğŸ”— ç»§æ‰¿å­æ§ä»¶æ˜¾ç¤º**é“¾æ¥å›¾æ ‡**
- ç°è‰²æ–œä½“æ–‡å­—æ˜¾ç¤ºç»§æ‰¿çš„Frame
- å³é”®èœå•ç¦ç”¨ä»¥ä¸‹æ“ä½œï¼š
  - âŒ é‡å‘½å
  - âŒ ç§»åŠ¨åˆ°...
  - âŒ åˆ é™¤
  - âŒ åˆ›å»ºè¡¨æ ¼/åœ†å½¢æ•°ç»„
  - âœ… ä»å¯å¤åˆ¶ï¼ˆåˆ›å»ºç‹¬ç«‹å‰¯æœ¬ï¼‰
  - âœ… ä»å¯é”å®š/éšè—

#### PropertiesPanelï¼ˆå±æ€§é¢æ¿ï¼‰
- æ˜¾ç¤ºç»§æ‰¿ä¿¡æ¯æ¨ªå¹…ï¼ˆæ©™è‰²ï¼‰
- æ ‡æ³¨æ¨¡æ¿æ¥æº
- æ˜¾ç¤ºç»§æ‰¿å­æ§ä»¶æ•°é‡
- æ¸…æ™°åŒºåˆ†"ç»§æ‰¿è‡ªæ¨¡æ¿"vs"ç»§æ‰¿çš„å­æ§ä»¶"

## æµ‹è¯•æ­¥éª¤

### æµ‹è¯•1ï¼šå¯¼å…¥å®˜æ–¹FDFæ–‡ä»¶

```typescript
// åœ¨tests/ç›®å½•è¿è¡Œ
bun run tests/test-withchildren.ts
```

**é¢„æœŸç»“æœ**ï¼š
- è§£æ BattleNetMain.fdf
- æ‰¾åˆ°ä½¿ç”¨ WITHCHILDREN çš„Frameï¼ˆå¦‚ BattleNetMainMenuï¼‰
- æ˜¾ç¤ºç»§æ‰¿çš„å­æ§ä»¶æ•°é‡
- éªŒè¯inheritedChildrenIdsæ­£ç¡®æ ‡è®°

### æµ‹è¯•2ï¼šUIå±‚çº§æ ‘æ˜¾ç¤º

**æ“ä½œæ­¥éª¤**ï¼š
1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š`bun tauri dev`
2. åœ¨ç¼–è¾‘å™¨ä¸­å¯¼å…¥ `target/vendor/UI/FrameDef/Glue/BattleNetMain.fdf`
3. åœ¨ProjectTreeä¸­å±•å¼€ **BattleNetMainMenu**
4. è§‚å¯Ÿç»§æ‰¿çš„å­æ§ä»¶ï¼ˆå¦‚ MainMenuBackdropï¼‰

**é¢„æœŸç»“æœ**ï¼š
- ç»§æ‰¿çš„å­æ§ä»¶æ˜¾ç¤º ğŸ”— å›¾æ ‡
- æ–‡å­—ä¸ºç°è‰²æ–œä½“
- å³é”®ç‚¹å‡»ç»§æ‰¿çš„å­æ§ä»¶æ—¶ï¼Œå¤§éƒ¨åˆ†æ“ä½œæ˜¾ç¤ºä¸ºç¦ç”¨ï¼ˆç°è‰²ï¼‰
- é¡¶éƒ¨æ˜¾ç¤º"ç»§æ‰¿çš„å­æ§ä»¶ï¼ˆåªè¯»ï¼‰"æç¤º

### æµ‹è¯•3ï¼šå±æ€§é¢æ¿æ˜¾ç¤º

**æ“ä½œæ­¥éª¤**ï¼š
1. é€‰ä¸­ä¸€ä¸ª**ä½¿ç”¨INHERITSçš„Frame**ï¼ˆå¦‚ BattleNetMainMenuï¼‰
2. æŸ¥çœ‹å±æ€§é¢æ¿é¡¶éƒ¨

**é¢„æœŸç»“æœ**ï¼š
- æ˜¾ç¤ºè“è‰²æ¨ªå¹…ï¼š"ç»§æ‰¿è‡ªæ¨¡æ¿: BattleNetMainMenuTemplate"
- æ˜¾ç¤ºç»§æ‰¿å­æ§ä»¶æ•°é‡ï¼š"åŒ…å« X ä¸ªç»§æ‰¿çš„å­æ§ä»¶"

**æ“ä½œæ­¥éª¤2**ï¼š
1. é€‰ä¸­ä¸€ä¸ª**ç»§æ‰¿çš„å­æ§ä»¶**ï¼ˆå¦‚ MainMenuBackdropï¼‰
2. æŸ¥çœ‹å±æ€§é¢æ¿é¡¶éƒ¨

**é¢„æœŸç»“æœ**ï¼š
- æ˜¾ç¤ºæ©™è‰²æ¨ªå¹…ï¼š"ç»§æ‰¿çš„å­æ§ä»¶ï¼ˆåªè¯»ï¼‰"
- æ˜¾ç¤ºçˆ¶Frameçš„æ¨¡æ¿æ¥æº

### æµ‹è¯•4ï¼šæ“ä½œé™åˆ¶éªŒè¯

**æ“ä½œæ­¥éª¤**ï¼š
1. å³é”®ç‚¹å‡»ç»§æ‰¿çš„å­æ§ä»¶
2. å°è¯•ç‚¹å‡»"é‡å‘½å"
3. å°è¯•ç‚¹å‡»"åˆ é™¤"

**é¢„æœŸç»“æœ**ï¼š
- æ‰€æœ‰ç ´åæ€§æ“ä½œå‡ä¸ºç¦ç”¨çŠ¶æ€
- é¼ æ ‡æ‚¬åœæ˜¾ç¤ºæç¤ºï¼š"ç»§æ‰¿çš„å­æ§ä»¶ä¸èƒ½XXX"
- "å¤åˆ¶"æ“ä½œä»ç„¶å¯ç”¨ï¼ˆåˆ›å»ºç‹¬ç«‹å‰¯æœ¬ï¼‰

### æµ‹è¯•5ï¼šRoundtripéªŒè¯

```bash
bun run tests/validate-all-official-fdf.ts
```

**é¢„æœŸç»“æœ**ï¼š
- æˆåŠŸç‡ > 90%
- é€šè¿‡æ–‡ä»¶åŒ…æ‹¬ï¼š
  - âœ… BattleNetProfilePanel.fdf (207 frames)
  - âœ… BattleNetMain.fdf
  - âœ… EscMenuMainPanel.fdf
  - ç­‰84ä¸ªå®˜æ–¹FDFæ–‡ä»¶ä¸­çš„77ä¸ª

## æŠ€æœ¯ç»†èŠ‚

### æ•°æ®ç»“æ„

```typescript
interface FDFMetadata {
  inherits?: string;              // ç»§æ‰¿çš„æ¨¡æ¿åç§°
  inheritedChildrenIds?: string[]; // ç»§æ‰¿å­æ§ä»¶çš„IDåˆ—è¡¨ï¼ˆåªè¯»ï¼‰
  isTemplate?: boolean;            // æ˜¯å¦æ˜¯æ¨¡æ¿å®šä¹‰
}

interface FDFFrameDefinition {
  inherits?: string;     // INHERITS "TemplateName"
  withChildren?: boolean; // WITHCHILDREN æ ‡è®°
}
```

### ç»§æ‰¿æµç¨‹

1. **è§£æé˜¶æ®µ**ï¼ˆFDFParserï¼‰
   - è¯†åˆ« `INHERITS [WITHCHILDREN] "Template"`
   - è®¾ç½® `withChildren: true`

2. **è½¬æ¢é˜¶æ®µ**ï¼ˆFDFTransformerï¼‰
   - ä»templateRegistryæŸ¥æ‰¾æ¨¡æ¿
   - å¤åˆ¶æ¨¡æ¿å±æ€§ï¼ˆå¯è¢«è¦†ç›–ï¼‰
   - å¦‚æœæœ‰WITHCHILDRENï¼Œæ·±æ‹·è´å­æ§ä»¶æ ‘
   - æ ‡è®° `inheritedChildrenIds`

3. **å¯¼å‡ºé˜¶æ®µ**ï¼ˆfdfExportï¼‰
   - è¾“å‡º `Frame "TYPE" "NAME" INHERITS WITHCHILDREN "Template" {`
   - è¿‡æ»¤æ‰ inheritedChildrenIds ä¸­çš„å­æ§ä»¶
   - åªå¯¼å‡ºè‡ªå®šä¹‰å±æ€§å’Œå­æ§ä»¶

4. **UIæ˜¾ç¤ºé˜¶æ®µ**ï¼ˆProjectTree/PropertiesPanelï¼‰
   - æ£€æŸ¥ `parentFrame.fdfMetadata?.inheritedChildrenIds`
   - å¦‚æœå½“å‰IDåœ¨åˆ—è¡¨ä¸­ â†’ åªè¯»æ ‡è®°
   - ç¦ç”¨ç›¸å…³æ“ä½œ

## å·²çŸ¥é™åˆ¶

1. **å¤šå±‚ç»§æ‰¿ä¼ é€’**ï¼ˆ2/84å¤±è´¥ï¼‰
   - QuestDialog.fdf ä¸­çš„ä¼ é€’ç»§æ‰¿ï¼ˆAâ†’Bâ†’Cï¼‰
   - BattleNetChatPanel.fdf ä¸­çš„æ¨¡æ¿å°ºå¯¸è¦†ç›–
   - è¿™æ˜¯è¾¹ç¼˜æƒ…å†µï¼Œä¸å½±å“ä¸»è¦åŠŸèƒ½

2. **StringListæ–‡ä»¶**ï¼ˆ5/84å¤±è´¥ï¼‰
   - DateStrings.fdf, GlobalStrings.fdfç­‰
   - è¿™äº›æ–‡ä»¶ä¸åŒ…å«Frameå®šä¹‰ï¼ˆé¢„æœŸå¤±è´¥ï¼‰

## æ€§èƒ½æ•°æ®

- æ¨¡æ¿åŠ è½½ï¼š149ä¸ªæ¨¡æ¿ï¼ˆ<100msï¼‰
- BattleNetProfilePanel.fdfï¼š207 framesï¼ˆå®Œç¾åŒ¹é…ï¼‰
- æ€»éªŒè¯æ—¶é—´ï¼š~2ç§’ï¼ˆ84ä¸ªæ–‡ä»¶ï¼‰

## æœªæ¥æ”¹è¿›

1. **å¯¼å‡ºIncludeæŒ‡ä»¤**
   - å½“å‰ï¼šå¯¼å‡ºæ—¶ä¸åŒ…å«IncludeFile
   - æ”¹è¿›ï¼šä¿ç•™åŸå§‹Includeç»“æ„

2. **å¤šå±‚ç»§æ‰¿ä¼˜åŒ–**
   - ä¼ é€’ç»§æ‰¿çš„å±æ€§åˆå¹¶é€»è¾‘
   - æ¨¡æ¿å°ºå¯¸è¦†ç›–å¤„ç†

3. **UIå¢å¼º**
   - ç»§æ‰¿å­æ§ä»¶çš„è§†è§‰é«˜äº®ï¼ˆè¾¹æ¡†ï¼‰
   - æ¨¡æ¿æ¥æºçš„æ‚¬åœæç¤º
   - ç»§æ‰¿é“¾çš„å¯è§†åŒ–å±•ç¤º
